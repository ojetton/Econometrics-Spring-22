---
title: "Problem Set 1"
author: "Owen Jetton"
date: "04/06/2022"
output: pdf_document
---

```{r setup, include=FALSE}
#This block code will make knitting faster by saving output of code chunks.
knitr::opts_chunk$set(cache = T)
  # Note that code chunks won't re-run unless you edit them

if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, lubridate, tidyverse)

setwd("/Users/owenjetton/Documents/PhD Year 1/Homeworks/Spring 2022/Econometrics-Spring-22")

```

## Question 1

```{r Data}
data = read.csv("data-001.csv")



```


## Question 2

```{r Regression}

reg1 = lm(data = data,
          formula = income_black_2010 ~ pop_enslaved_1860 + pop_total_1860 + pop_total_2010)

q2_coef = reg1$coefficients[["pop_enslaved_1860"]]

summary(reg1)
```

The coefficient on "pop_enslaved_1980" is `r q2_coef`


## Question 3

```{r Matrix Regression}
# endogenous variable
Y = as.matrix(data$income_black_2010)

# exogenous variables (with intercept)
X = matrix(c(rep(1, 710), data$pop_enslaved_1860, data$pop_total_1860, data$pop_total_2010), 
                    ncol = 4)

reg_q3 = solve(t(X) %*% X) %*% t(X) %*% Y

reg_q3[2,1]
```

The coefficient on "pop_enslaved_1980" is `r reg_q3[2,1]` which is the same as in question 2.


## Question 4

```{r Regression Function}

reg_fun = function(y, x) {
  coef = solve(t(x) %*% x) %*% t(x) %*% y
  
  return(coef)
}

```

## Question 5

```{r Regression function With Standard Errors}

reg_fun2 = function(y, x) {
  
  # coefficient equation
  coef = solve(t(x) %*% x) %*% t(x) %*% y
  
  # standard errors
    # error (residuals)
  e = (y - x %*% coef)
    # variance sigma estimate calculation
  s_sq = (1/(dim(x)[1] - dim(x)[2]-1))*sum(e^2)
  
  # calculate variance matrix
  variance_matrix = s_sq * solve(t(x) %*% x)
  
  # arrange the results
  stnd_errors = sqrt(diag(variance_matrix))
  
  results = cbind(coef, stnd_errors)
  
  return(results)
  
}

```

Results:

```{r}
reg_fun2(Y, X)

```

My function reports the coefficients and standard error correctly.

## Question 6

To be approximately correct, the standard errors reported from my function rely on the assumptions of homoskedasticity, nonautocorrelation, and normally distributed errors: 
$$ \epsilon | X \sim N(0, \sigma^2 I) $$ 

## Question 7

In order for my coefficients to be interpretable as causal, one needs to assume that the model we're estimating is the true model, that there are no omitted relevant variables, that the exogenous variables are in fact *exogenous*.



## Extra Credit

```{r Extra Credit}

reg_fun3 = function(data, var_y, var_x) {

  y = as.matrix(data %>% select(all_of(var_y)))
  
  x = as.matrix(cbind(intercept = c(rep(1, length(y))), 
                      data %>% select(all_of(var_x))))
  
  # coefficient equation
  coef = solve(t(x) %*% x) %*% t(x) %*% y
  
  # standard errors
    # error (residuals)
  e = (y - x %*% coef)
    # standard error calculation
  s_sq = (1/(dim(x)[1] - dim(x)[2]-1))*sum(e^2)
  
  # calculate variance matrix
  variance_matrix = s_sq * solve(t(x) %*% x)
  
  # arrange the results
  stnd_errors = sqrt(diag(variance_matrix))
  
  results = cbind(coef, stnd_errors)
  
  return(results)
  
}
```

# Results:

```{r Extra Credit Results}
reg_fun3(data = data, 
         var_y = c("income_black_2010"), 
         var_x = c("pop_enslaved_1860", "pop_total_1860", "pop_total_2010")
)

```



